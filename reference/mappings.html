
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Configuring Services Â· Ambassador: open source API Gateway for microservices and Kubernetes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="canary.html" />
    
    
    <link rel="prev" href="core/tls.html" />
    

    </head>
    <body>
        
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-TPMQ838" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){
            w[l]=w[l]||[];
            w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
            var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),
                dl=l!='dataLayer'?'&l='+l:'';
            j.async=true;
            j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;
            f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-TPMQ838');
    </script>
    
<div class="book">
    <div class="book-summary">
        
<a href="/" class="logo__link">
    <img class="logo" src="/images/ambassador-logo.svg" alt="logo">
</a>


            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://blog.getambassador.io">
            
                    
                    Blog
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../about/why-ambassador.html">
            
                <a href="../about/why-ambassador.html">
            
                    
                    Why Ambassador?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../about/features-and-benefits.html">
            
                <a href="../about/features-and-benefits.html">
            
                    
                    Features and Benefits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../user-guide/install.html">
            
                <a href="../user-guide/install.html">
            
                    
                    Installing Ambassador
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../user-guide/getting-started.html">
            
                <a href="../user-guide/getting-started.html">
            
                    
                    Kubernetes (YAML)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../user-guide/helm.html">
            
                <a href="../user-guide/helm.html">
            
                    
                    Kubernetes (Helm)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="../about/quickstart.html">
            
                <a href="../about/quickstart.html">
            
                    
                    Docker Quickstart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="../user-guide/docker-compose.html">
            
                <a href="../user-guide/docker-compose.html">
            
                    
                    Docker Compose
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Concepts</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../concepts/developers.html">
            
                <a href="../concepts/developers.html">
            
                    
                    Decentralized configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../concepts/architecture.html">
            
                <a href="../concepts/architecture.html">
            
                    
                    Ambassador Architecture
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" >
            
                <a target="_blank" href="https://blog.getambassador.io/envoy-vs-nginx-vs-haproxy-why-the-open-source-ambassador-api-gateway-chose-envoy-23826aed79ef">
            
                    
                    Why Ambassador uses Envoy Proxy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../about/microservices-api-gateways.html">
            
                <a href="../about/microservices-api-gateways.html">
            
                    
                    Microservices API Gateways
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../concepts/using-ambassador-in-org.html">
            
                <a href="../concepts/using-ambassador-in-org.html">
            
                    
                    Using Ambassador in your organization
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Guides</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../user-guide/auth-tutorial.html">
            
                <a href="../user-guide/auth-tutorial.html">
            
                    
                    Adding Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../user-guide/rate-limiting-tutorial.html">
            
                <a href="../user-guide/rate-limiting-tutorial.html">
            
                    
                    Adding Rate Limiting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../user-guide/tracing-tutorial.html">
            
                <a href="../user-guide/tracing-tutorial.html">
            
                    
                    Adding Tracing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../user-guide/grpc.html">
            
                <a href="../user-guide/grpc.html">
            
                    
                    Use gRPC with Ambassador
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../user-guide/tls-termination.html">
            
                <a href="../user-guide/tls-termination.html">
            
                    
                    TLS Termination
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../user-guide/with-istio.html">
            
                <a href="../user-guide/with-istio.html">
            
                    
                    Istio and Ambassador
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" >
            
                <a target="_blank" href="https://blog.getambassador.io/howto/home">
            
                    
                    More guides
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuring Ambassador
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="modules.html">
            
                <a href="modules.html">
            
                    
                    Core Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1.1" data-path="core/tls.html">
            
                <a href="core/tls.html">
            
                    
                    TLS and X-Forwarded-Proto
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="5.1.2" data-path="mappings.html">
            
                <a href="mappings.html">
            
                    
                    Configuring Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.2.1" data-path="canary.html">
            
                <a href="canary.html">
            
                    
                    Canary Releases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.2" data-path="cors.html">
            
                <a href="cors.html">
            
                    
                    Cross Origin Resource Sharing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.3" data-path="override.html">
            
                <a href="override.html">
            
                    
                    Custom Envoy config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.4" data-path="headers.html">
            
                <a href="headers.html">
            
                    
                    Header-based routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.5" data-path="host.html">
            
                <a href="host.html">
            
                    
                    Host Header
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.6" data-path="rate-limits.html">
            
                <a href="rate-limits.html">
            
                    
                    Rate Limits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.7" data-path="redirects.html">
            
                <a href="redirects.html">
            
                    
                    Redirects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.8" data-path="add_request_headers.html">
            
                <a href="add_request_headers.html">
            
                    
                    Request Headers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.9" data-path="rewrites.html">
            
                <a href="rewrites.html">
            
                    
                    Rewrites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2.10" data-path="shadowing.html">
            
                <a href="shadowing.html">
            
                    
                    Traffic Shadowing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="services/services.html">
            
                <a href="services/services.html">
            
                    
                    External Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.3.1" data-path="services/auth-service.html">
            
                <a href="services/auth-service.html">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.2" data-path="services/rate-limit-service.html">
            
                <a href="services/rate-limit-service.html">
            
                    
                    Rate Limiting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3.3" data-path="services/tracing-service.html">
            
                <a href="services/tracing-service.html">
            
                    
                    Tracing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="advanced.html">
            
                <a href="advanced.html">
            
                    
                    Advanced configuration topics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="running.html">
            
                <a href="running.html">
            
                    
                    Running Ambassador
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="diagnostics.html">
            
                <a href="diagnostics.html">
            
                    
                    Diagnostics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="ambassador-with-aws.html">
            
                <a href="ambassador-with-aws.html">
            
                    
                    Ambassador with AWS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="upgrading.html">
            
                <a href="upgrading.html">
            
                    
                    Upgrading Ambassador
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="statistics.html">
            
                <a href="statistics.html">
            
                    
                    Statistics and Monitoring
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Developers</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <a target="_blank" href="https://github.com/datawire/ambassador/blob/master/BUILDING.md">
            
                    
                    Building Ambassador (GitHub)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" >
            
                <a target="_blank" href="https://github.com/datawire/ambassador/blob/master/CHANGELOG.md">
            
                    
                    Changelog (GitHub)
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Need Help?</li>
        
        
    
        <li class="chapter " data-level="7.1" >
            
                <a target="_blank" href="https://d6e.co/slack">
            
                    
                    Ask on Slack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" >
            
                <a target="_blank" href="https://github.com/datawire/ambassador/issues/new">
            
                    
                    File a GitHub Issue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" >
            
                <a target="_blank" href="https://www.datawire.io">
            
                    
                    Visit Datawire.io
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        

    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Configuring Services</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
<a id="datawire-breadcrumb" href="https://datawire.io/learn/open-source-docs">
    â Back to Datawire Open Source Documentation
</a>

                                <h2 id="configuring-services">Configuring Services</h2>
<p>Ambassador is designed so that the author of a given Kubernetes service can easily and flexibly configure how traffic gets routed to the service. The core abstraction used to support service authors is a <code>mapping</code>.</p>
<h3 id="mappings">Mappings</h3>
<p>Mappings associate REST <a href="#resources"><em>resources</em></a> with Kubernetes <a href="#services"><em>services</em></a>. A resource, here, is a group of things defined by a URL prefix; a service is exactly the same as in Kubernetes. Ambassador <em>must</em> have one or more mappings defined to provide access to any services at all.</p>
<p>Each mapping can also specify, among other things:</p>
<ul>
<li>a <a href="rewrite"><em>rewrite rule</em></a> which modifies the URL as it&apos;s handed to the Kubernetes service;</li>
<li>a <a href="canary"><em>weight</em></a> specifying how much of the traffic for the resource will be routed using the mapping;</li>
<li>a <a href="host"><em>host</em></a> specifying a required value for the HTTP <code>Host</code> header;</li>
<li>a <a href="shadowing"><em>shadow</em></a> marker, specifying that this mapping will get a copy of traffic for the resource; and</li>
<li>other <a href="headers"><em>headers</em></a> which must appear in the HTTP request.</li>
</ul>
<h3 id="defining-mappings">Defining Mappings</h3>
<p>Mapping definitions are fairly straightforward. Here&apos;s an example for a REST service which Ambassador will contact using HTTP:</p>
<pre><code class="lang-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ambassador/v0
<span class="hljs-attr">kind:</span>  Mapping
<span class="hljs-attr">name:</span>  qotm_mapping
<span class="hljs-attr">prefix:</span> /qotm/
<span class="hljs-attr">service:</span> http://qotm
</code></pre>
<p>and a REST service which Ambassador will contact using HTTPS:</p>
<pre><code class="lang-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ambassador/v0
<span class="hljs-attr">kind:</span>  Mapping
<span class="hljs-attr">name:</span>  quote_mapping
<span class="hljs-attr">prefix:</span> /qotm/quote/
<span class="hljs-attr">rewrite:</span> /quotation/
<span class="hljs-attr">service:</span> https://qotm
</code></pre>
<p>(Note that the &apos;http://&apos; prefix for an HTTP service is optional.)</p>
<p>Here&apos;s an example for a CQRS service (using HTTP):</p>
<pre><code class="lang-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ambassador/v0
<span class="hljs-attr">kind:</span> Mapping
<span class="hljs-attr">name:</span> cqrs_get_mapping
<span class="hljs-attr">prefix:</span> /cqrs/
<span class="hljs-attr">method:</span> GET
<span class="hljs-attr">service:</span> getcqrs
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ambassador/v0
<span class="hljs-attr">kind:</span> Mapping
<span class="hljs-attr">name:</span> cqrs_put_mapping
<span class="hljs-attr">prefix:</span> /cqrs/
<span class="hljs-attr">method:</span> PUT
<span class="hljs-attr">service:</span> putcqrs
</code></pre>
<p>Required attributes for mappings:</p>
<ul>
<li><code>name</code> is a string identifying the <code>Mapping</code> (e.g. in diagnostics)</li>
<li><code>prefix</code> is the URL prefix identifying your <a href="#resources">resource</a></li>
<li><code>service</code> is the name of the <a href="#services">service</a> handling the resource; must include the namespace (e.g. <code>myservice.othernamespace</code>) if the service is in a different namespace than Ambassador</li>
</ul>
<h3 id="configuring-mappings">Configuring Mappings</h3>
<p>Ambassador supports a number of additional attributes to configure and customize mappings.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Attribute</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="add_request_headers"><code>add_request_headers</code></a></td>
<td style="text-align:left">specifies a dictionary of other HTTP headers that should be added to each request when talking to the service</td>
</tr>
<tr>
<td style="text-align:left"><a href="cors"><code>cors</code></a></td>
<td style="text-align:left">enables Cross-Origin Resource Sharing (CORS) setting on a mapping</td>
</tr>
<tr>
<td style="text-align:left"><a href="../user-guide/grpc"><code>grpc</code></a></td>
<td style="text-align:left">if true, tells the system that the service will be handling gRPC calls</td>
</tr>
<tr>
<td style="text-align:left"><a href="headers"><code>headers</code></a></td>
<td style="text-align:left">specifies a list of other HTTP headers which <em>must</em> appear in the request for this mapping to be used to route the request</td>
</tr>
<tr>
<td style="text-align:left"><a href="host"><code>host</code></a></td>
<td style="text-align:left">specifies the value which <em>must</em> appear in the request&apos;s HTTP <code>Host</code> header for this mapping to be used to route the request</td>
</tr>
<tr>
<td style="text-align:left"><a href="host"><code>host_regex</code></a></td>
<td style="text-align:left">if true, tells the system to interpret the <code>host</code> as a <a href="http://en.cppreference.com/w/cpp/regex/ecmascript" target="_blank">regular expression</a></td>
</tr>
<tr>
<td style="text-align:left"><a href="host"><code>host_rewrite</code></a></td>
<td style="text-align:left">forces the HTTP <code>Host</code> header to a specific value when talking to the service</td>
</tr>
<tr>
<td style="text-align:left"><code>method</code></td>
<td style="text-align:left">defines the HTTP method for this mapping (e.g. GET, PUT, etc. -- must be all uppercase)</td>
</tr>
<tr>
<td style="text-align:left"><code>method_regex</code></td>
<td style="text-align:left">if true, tells the system to interpret the <code>method</code> as a <a href="http://en.cppreference.com/w/cpp/regex/ecmascript" target="_blank">regular expression</a></td>
</tr>
<tr>
<td style="text-align:left"><code>prefix_regex</code></td>
<td style="text-align:left">if true, tells the system to interpret the <code>prefix</code> as a <a href="http://en.cppreference.com/w/cpp/regex/ecmascript" target="_blank">regular expression</a></td>
</tr>
<tr>
<td style="text-align:left"><a href="rate-limits"><code>rate_limits</code></a></td>
<td style="text-align:left">specifies a list rate limit rules on a mapping</td>
</tr>
<tr>
<td style="text-align:left"><code>regex_headers</code></td>
<td style="text-align:left">specifies a list of HTTP headers and <a href="http://en.cppreference.com/w/cpp/regex/ecmascript" target="_blank">regular expressions</a> which <em>must</em> match for this mapping to be used to route the request</td>
</tr>
<tr>
<td style="text-align:left"><a href="rewrites"><code>rewrite</code></a></td>
<td style="text-align:left">replaces the URL prefix with when talking to the service</td>
</tr>
<tr>
<td style="text-align:left"><code>timeout_ms</code></td>
<td style="text-align:left">the timeout, in milliseconds, for requests through this <code>Mapping</code>. Defaults to 3000.</td>
</tr>
<tr>
<td style="text-align:left"><a href="#using-tls"><code>tls</code></a></td>
<td style="text-align:left">if true, tells the system that it should use HTTPS to contact this service. (It&apos;s also possible to use <code>tls</code> to specify a certificate to present to the service.)</td>
</tr>
<tr>
<td style="text-align:left"><code>use_websocket</code></td>
<td style="text-align:left">if true, tells Ambassador that this service will use websockets</td>
</tr>
</tbody>
</table>
<p>Ambassador supports multiple deployment patterns for your services. These patterns are designed to let you safely release new versions of your service, while minimizing its impact on production users.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Attribute</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="shadowing"><code>shadow</code></a></td>
<td style="text-align:left">if true, a copy of the resource&apos;s traffic will go the <code>service</code> for this <code>Mapping</code>, and the reply will be ignored.</td>
</tr>
<tr>
<td style="text-align:left"><a href="canary"><code>weight</code></a></td>
<td style="text-align:left">specifies the (integer) percentage of traffic for this resource that will be routed using this mapping</td>
</tr>
</tbody>
</table>
<p>These attributes are less commonly used, but can be used to override Ambassador&apos;s default behavior in specific cases.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Attribute</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>auto_host_rewrite</code></td>
<td style="text-align:left">if true, forces the HTTP <code>Host</code> header to the <code>service</code> to which Ambassador routes</td>
</tr>
<tr>
<td style="text-align:left"><code>case_sensitive</code></td>
<td style="text-align:left">determines whether <code>prefix</code> matching is case-sensitive; defaults to True</td>
</tr>
<tr>
<td style="text-align:left"><a href="override"><code>envoy_override</code></a></td>
<td style="text-align:left">supplies raw configuration data to be included with the generated Envoy route entry.</td>
</tr>
<tr>
<td style="text-align:left"><a href="redirects"><code>host_redirect</code></a></td>
<td style="text-align:left">if true, this <code>Mapping</code> performs an HTTP 301 <code>Redirect</code>, with the host portion of the URL replaced with the <code>service</code> value.</td>
</tr>
<tr>
<td style="text-align:left"><a href="redirects"><code>path_redirect</code></a></td>
<td style="text-align:left">if set when <code>host_redirect</code> is also true, the path portion of the URL will replaced with the <code>path_redirect</code> value in the HTTP 301 <code>Redirect</code>.</td>
</tr>
<tr>
<td style="text-align:left"><a href="precedence"><code>precedence</code></a></td>
<td style="text-align:left">an integer overriding Ambassador&apos;s internal ordering for <code>Mapping</code>s. An absent <code>precedence</code> is the same as a <code>precedence</code> of 0. Higher <code>precedence</code> values are matched earlier.</td>
</tr>
</tbody>
</table>
<p>The name of the mapping must be unique. If no <code>method</code> is given, all methods will be proxied.</p>
<h3 id="mapping-evaluation-order">Mapping Evaluation Order</h3>
<p>Ambassador sorts mappings such that those that are more highly constrained are evaluated before those less highly constrained. The prefix length, the request method and the constraint headers are all taken into account.</p>
<p>If absolutely necessary, you can manually set a <code>precedence</code> on the mapping (see below). In general, you should not need to use this feature unless you&apos;re using the <code>regex_headers</code> or <code>host_regex</code> matching features. If there&apos;s any question about how Ambassador is ordering rules, the diagnostic service is a good first place to look: the order in which mappings appear in the diagnostic service is the order in which they are evaluated.</p>
<h3 id="optional-fallback-mapping">Optional Fallback Mapping</h3>
<p>Ambassador will respond with a <code>404 Not Found</code> to any request for which no mapping exists. If desired, you can define a fallback &quot;catch-all&quot; mapping so all unmatched requests will be sent to an upstream service.</p>
<p>For example, defining a mapping with only a <code>/</code> prefix will catch all requests previously unhandled and forward them to an external service:</p>
<pre><code class="lang-yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ambassador/v0
<span class="hljs-attr">kind:</span> Mapping
<span class="hljs-attr">name:</span> catch-all
<span class="hljs-attr">prefix:</span> /
<span class="hljs-attr">service:</span> https://www.getambassador.io
</code></pre>
<h4 id="using-precedence"><a name="precedence"></a> Using <code>precedence</code></h4>
<p>Ambassador sorts mappings such that those that are more highly constrained are evaluated before those less highly constrained. The prefix length, the request method and the constraint headers are all taken into account. These mechanisms, however, may not be sufficient to guarantee the correct ordering when regular expressions or highly complex constraints are in play.</p>
<p>For those situations, a <code>Mapping</code> can explicitly specify the <code>precedence</code>. A <code>Mapping</code> with no <code>precedence</code> is assumed to have a <code>precedence</code> of 0; the higher the <code>precedence</code> value, the earlier the <code>Mapping</code> is attempted.</p>
<p>If multiple <code>Mapping</code>s have the same <code>precedence</code>, Ambassador&apos;s normal sorting determines the ordering within the <code>precedence</code>; however, there is no way that Ambassador can ever sort a <code>Mapping</code> with a lower <code>precedence</code> ahead of one at a higher <code>precedence</code>.</p>
<h4 id="using-tls"><a name="using-tls"></a> Using <code>tls</code></h4>
<p>In most cases, you won&apos;t need the <code>tls</code> attribute: just use a <code>service</code> with an <code>https://</code> prefix. However, note that if the <code>tls</code> attribute is present and <code>true</code>, Ambassador will originate TLS even if the <code>service</code> does not have the <code>https://</code> prefix.</p>
<p>If <code>tls</code> is present with a value that is not <code>true</code>, the value is assumed to be the name of a defined TLS context, which will determine the certificate presented to the upstream service. TLS context handling is a beta feature of Ambassador at present; please <a href="https://d6e.co/slack" target="_blank">contact us on Slack</a> if you need to specify TLS origination certificates.</p>
<h3 id="namespaces-and-mappings">Namespaces and Mappings</h3>
<p>Given that <code>AMBASSADOR_NAMESPACE</code> is correctly set, Ambassador can map to services in other namespaces by taking advantage of Kubernetes DNS:</p>
<ul>
<li><code>service: servicename</code> will route to a service in the same namespace as the Ambassador, and</li>
<li><code>service: servicename.namespace</code> will route to a service in a different namespace.</li>
</ul>
<h3 id="resources">Resources</h3>
<p>To Ambassador, a <code>resource</code> is a group of one or more URLs that all share a common prefix in the URL path. For example:</p>
<pre><code class="lang-shell">https://ambassador.example.com/resource1/foo
https://ambassador.example.com/resource1/bar
https://ambassador.example.com/resource1/baz/zing
https://ambassador.example.com/resource1/baz/zung
</code></pre>
<p>all share the <code>/resource1/</code> path prefix, so can be considered a single resource. On the other hand:</p>
<pre><code class="lang-shell">https://ambassador.example.com/resource1/foo
https://ambassador.example.com/resource2/bar
https://ambassador.example.com/resource3/baz/zing
https://ambassador.example.com/resource4/baz/zung
</code></pre>
<p>share only the prefix <code>/</code> -- you <em>could</em> tell Ambassador to treat them as a single resource, but it&apos;s probably not terribly useful.</p>
<p>Note that the length of the prefix doesn&apos;t matter: if you want to use prefixes like <code>/v1/this/is/my/very/long/resource/name/</code>, go right ahead, Ambassador can handle it.</p>
<p>Also note that Ambassador does not actually require the prefix to start and end with <code>/</code> -- however, in practice, it&apos;s a good idea. Specifying a prefix of</p>
<pre><code class="lang-shell">/man
</code></pre>
<p>would match all of the following:</p>
<pre><code class="lang-shell">https://ambassador.example.com/man/foo
https://ambassador.example.com/mankind
https://ambassador.example.com/man-it-is/really-hot-today
https://ambassador.example.com/manohmanohman
</code></pre>
<p>which is probably not what was intended.</p>
<h3 id="services">Services</h3>
<p>A <code>service</code> is simply a URL to Ambassador. For example:</p>
<ul>
<li><code>servicename</code> assumes that DNS can resolve the bare servicename, and that it&apos;s listening on the default HTTP port;</li>
<li><code>servicename.domain</code> supplies a domain name (for example, you might do this to route across namespaces in Kubernetes); and</li>
<li><code>service:3000</code> supplies a nonstandard port number.</li>
</ul>
<p>At present, Ambassador relies on Kubernetes to do load balancing: it trusts that using the DNS to look up the service by name will do the right thing in terms of spreading the load across all instances of the service.</p>

                                

                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="core/tls.html" class="navigation navigation-prev " aria-label="Previous page: TLS and X-Forwarded-Proto">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="canary.html" class="navigation navigation-next " aria-label="Next page: Canary Releases">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Configuring Services","level":"5.1.2","depth":2,"next":{"title":"Canary Releases","level":"5.1.2.1","depth":3,"path":"reference/canary.md","ref":"reference/canary.md","articles":[]},"previous":{"title":"TLS and X-Forwarded-Proto","level":"5.1.1.1","depth":3,"path":"reference/core/tls.md","ref":"reference/core/tls.md","articles":[]},"dir":"ltr"},"config":{"plugins":["gtm","anchorjs"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"gtm":{"token":"GTM-TPMQ838","virtualPageViews":true},"search":{},"layout":{"footerPath":"layouts/footer.html"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{"selector":"h2,h3,h4,h5","placement":"right","visible":"always","truncate":64,"ariaLabel":"Anchor"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"INDEX.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Ambassador: open source API Gateway for microservices and Kubernetes","gitbook":"*"},"file":{"path":"reference/mappings.md","mtime":"2020-08-25T18:44:25.444Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-09-14T18:10:30.972Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>


        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-gtm/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <script src="/js/datawire-breadcrumb.js" type="text/javascript"></script>

    </body>
</html>

